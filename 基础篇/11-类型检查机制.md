# ç±»å‹æ£€æŸ¥æœºåˆ¶

> `TypeScript` ç¼–è¯‘å™¨åœ¨åšç±»å‹æ£€æŸ¥æ—¶ï¼Œæ‰€ç§‰æ‰¿çš„ä¸€äº›åŸåˆ™ï¼Œä»¥åŠè¡¨ç°å‡ºçš„ä¸€äº›è¡Œä¸ºã€‚

- **ä½œç”¨ï¼šè¾…åŠ©å¼€å‘ï¼Œæé«˜å¼€å‘æ•ˆç‡ã€‚**
- åˆ†ç±»ï¼š
  - ç±»å‹æ¨æ–­
  - ç±»å‹å…¼å®¹æ€§
  - ç±»å‹ä¿æŠ¤

## ç±»å‹æ¨æ–­

> ä¸éœ€è¦æŒ‡å®šå˜é‡çš„ç±»å‹ï¼ˆå‡½æ•°è¿”å›å€¼çš„ç±»å‹ï¼‰ï¼Œ`TypeScript` å¯ä»¥æ ¹æ®æŸäº›è§„åˆ™è‡ªåŠ¨æ¨æ–­å‡ºä¸€ä¸ªç±»å‹ã€‚

- **åŸºç¡€ç±»å‹æ¨æ–­**

  > ä»å³å‘å·¦æ¨æ–­ï¼Œæ ¹æ®è¡¨è¾¾å¼å³ä¾§çš„å€¼ï¼Œæ¨æ–­è¡¨è¾¾å¼å·¦ä¾§çš„ç±»å‹ã€‚

  - å˜é‡ç±»å‹

    ```ts
    let a = 1; // let a: number
    let b = "string"; // let b: string
    ```

  - å‡½æ•°é»˜è®¤å‚æ•°
    ```ts
    let x = (a = 1) => {}; // (parameter) a: number
    ```
  - å‡½æ•°è¿”å›å€¼
    ```ts
    let x = (a = 1) => a + 1; // let x: (a?: number) => number
    ```

- **æœ€ä½³é€šç”¨ç±»å‹æ¨æ–­**
  > ä»å³å‘å·¦æ¨æ–­ã€‚
  > è®¡ç®—é€šç”¨ç±»å‹ç®—æ³•ä¼šè€ƒè™‘æ‰€æœ‰çš„å€™é€‰ç±»å‹ï¼Œå¹¶ç»™å‡ºä¸€ä¸ªå…¼å®¹æ‰€æœ‰å€™é€‰ç±»å‹çš„ç±»å‹ã€‚
  > å¦‚æœæ²¡æœ‰æ‰¾åˆ°æœ€ä½³é€šç”¨ç±»å‹çš„è¯ï¼Œç±»å‹æ¨æ–­çš„ç»“æœä¸ºè”åˆç±»å‹ã€‚
  ```ts
  let c = [1, 2]; // let c: number[]
  let d = [1, null];
  /*
   ** åœ¨ strictNullChecks:true æ—¶ï¼Œlet d: (number | null)[]
   ** åœ¨ strictNullChecks:false æ—¶ï¼Œlet d: number[]
   */
  ```
- **ä¸Šä¸‹æ–‡ç±»å‹æ¨æ–­**

  > ä»å·¦å‘å³æ¨æ–­ï¼Œå‘ç”Ÿåœ¨è¡¨è¾¾å¼çš„ç±»å‹ä¸æ‰€å¤„çš„ä½ç½®ç›¸å…³æ—¶ã€‚

  ```ts
  window.onkeydown = (event: string) => {}; // error!
  window.onkeydown = (event: KeyboardEvent) => {}; // ok!
  ```

  - ä½¿ç”¨åœºæ™¯ï¼š
    - å‡½æ•°çš„å‚æ•°ï¼Œèµ‹å€¼è¡¨è¾¾å¼çš„å³è¾¹ï¼Œç±»å‹æ–­è¨€ï¼Œå¯¹è±¡æˆå‘˜å’Œæ•°ç»„å­—é¢é‡å’Œè¿”å›å€¼è¯­å¥ã€‚
    - ä¸Šä¸‹æ–‡ç±»å‹ä¹Ÿä¼šåšä¸ºæœ€ä½³é€šç”¨ç±»å‹çš„å€™é€‰ç±»å‹ã€‚
      ```ts
      function createZoo(): Animal[] {
        return [new Rhino(), new Elephant(), new Snake()];
      }
      ```
      æœ€ä½³ç±»å‹å€™é€‰è€…æœ‰ 4 ä¸ªï¼š`Animal`ã€`Rhino`ã€`Elephant`ã€`Snake`ã€‚

- **å¦‚æœ ts çš„æ¨æ–­ä¸ç¬¦åˆä½ çš„é¢„æœŸï¼Ÿ**

  å½“ä½ æœ‰è‡ªä¿¡æ¯” `ts` æ›´äº†è§£ä½ çš„ä»£ç æ—¶ï¼Œä½ å¯ä»¥ç”¨ **ç±»å‹æ–­è¨€** æ¥è¦†ç›– `ts` çš„æ¨è®ºã€‚

  ```ts
  let foo = {};
  foo.bar = 1; // Property 'bar' does not exist on type '{}'.
  ```

  æ­¤æ—¶ï¼Œæˆ‘ä»¬å¯ä»¥ä¸º `foo` æ·»åŠ ä¸€ä¸ªç±»å‹æ–­è¨€ã€‚

  ```ts
  interface Foo {
    bar: number;
  }
  let foo = {} as Foo;
  foo.bar = 1; // ok!
  ```

  ä½†æ˜¯å½“æˆ‘ä»¬å»æ‰è¯­å¥ `foo.bar = 1; `ï¼Œä¹Ÿæ²¡æœ‰æŠ¥é”™ï¼›ä½†æ­¤æ—¶ `foo` å¹¶æ²¡æœ‰å±¥è¡Œ `Foo` çš„çº¦å®šã€‚æ‰€ä»¥ï¼Œæˆ‘ä»¬è¿˜æ˜¯åº”è¯¥åœ¨ `foo` å£°æ˜æ—¶ç›´æ¥æŒ‡å®šä¸º `Foo` ç±»å‹ã€‚

  ```ts
  let foo: Foo = { bar: 1 };
  ```

  **æ€»ç»“ï¼Œ** ç±»å‹æ–­è¨€å¯ä»¥å¢åŠ ä»£ç çš„çµæ´»æ€§ï¼Œåœ¨æ”¹é€ æ—§ä»£ç æ—¶éå¸¸æœ‰æ•ˆï¼›ä½†ä¸èƒ½æ»¥ç”¨ï¼Œä¸ç†Ÿæ‚‰ä¸Šä¸‹æ–‡çš„æƒ…å†µä¸‹ï¼Œä¼šå¸¦æ¥å®‰å…¨éšæ‚£ã€‚

## ç±»å‹å…¼å®¹æ€§

> `TS` å…è®¸ä¸åŒç±»å‹çš„å˜é‡åœ¨ä¸€å®šè§„åˆ™ä¸‹ç›¸äº’èµ‹å€¼ï¼Œå¢åŠ è¯­è¨€çš„çµæ´»æ€§ã€‚
> `TS` é‡Œçš„ç±»å‹å…¼å®¹æ€§æ˜¯åŸºäºç»“æ„å­ç±»å‹çš„ã€‚ç»“æ„ç±»å‹æ˜¯ä¸€ç§åªä½¿ç”¨å…¶æˆå‘˜æ¥æè¿°ç±»å‹çš„æ–¹å¼ã€‚å®ƒæ­£å¥½ä¸åä¹‰ï¼ˆ`nominal`ï¼‰ç±»å‹å½¢æˆå¯¹æ¯”ã€‚

- å¿«é€Ÿè®°å¿†

  - å…¬å¼åŒ–

    å½“ä¸€ä¸ª `ç±»å‹ Y` å¯ä»¥è¢«èµ‹å€¼ç»™å¦ä¸€ä¸ª `ç±»å‹ X` æ—¶ï¼Œæˆ‘ä»¬å°±å¯ä»¥è¯´ `ç±»å‹ X` å…¼å®¹ `ç±»å‹ Y`ã€‚

    `X å…¼å®¹ Y : X(ç›®æ ‡ç±»å‹) = Y(æºç±»å‹)`

  - å£è¯€

    ç»“æ„ä¹‹é—´å…¼å®¹ï¼šæˆå‘˜å°‘çš„å…¼å®¹æˆå‘˜å¤šçš„ï¼›
    å‡½æ•°ä¹‹é—´å…¼å®¹ï¼šå‚æ•°å¤šçš„å…¼å®¹å‚æ•°å°‘çš„ã€‚

### åŸå§‹ç±»å‹å’Œå¯¹è±¡ç±»å‹

`TypeScript` ç»“æ„åŒ–ç±»å‹ç³»ç»Ÿçš„åŸºæœ¬åŸåˆ™æ˜¯ï¼Œå¦‚æœ `x` æƒ³å…¼å®¹ `y`ï¼Œé‚£ä¹ˆ `y` è‡³å°‘å…·æœ‰å’Œ `x` ç›¸åŒçš„å±æ€§ã€‚

```ts
// strictNullChecks: false
let aa = 1;
let bb = null;
aa = bb;

let a = { name: "" };
let b = { name: "string" };
a = b;
```

æ£€æŸ¥å‡½æ•°å‚æ•°æ—¶ä½¿ç”¨ç›¸åŒçš„è§„åˆ™ã€‚

```ts
interface Named {
  name: string;
}
let y = { name: "", age: 1 };

function greet(n: Named) {
  console.log("hello" + n.name);
}

greet(y);
```

### æ¥å£

æˆå‘˜å°‘çš„ å…¼å®¹ æˆå‘˜å¤šçš„ã€‚

```ts
interface X {
  a: number;
  b: number;
}
interface Y {
  a: number;
  b: number;
  c: number;
}
let x: X = { a: 1, b: 2 };
let y: Y = { a: 1, b: 2, c: 3 };
x = y;
y = x; // error!
```

### å‡½æ•°

åˆ¤æ–­ä¸¤ä¸ªå‡½æ•°æ˜¯å¦å…¼å®¹ï¼Œé€šå¸¸å‘ç”Ÿåœ¨å‡½æ•°ç›¸äº’èµ‹å€¼çš„æƒ…å†µä¸‹ï¼ˆæ¯”å¦‚å‡½æ•°ä½œä¸ºå‚æ•°ï¼‰ã€‚

```ts
type Handler = (a: number, b: number) => number;
function hof(handler: Handler) {
  return handler;
}
```

åœ¨è¿™ä¸ªä¾‹å­é‡Œï¼Œ`handler` ä½œä¸ºç›®æ ‡å‡½æ•°ï¼Œä¼ å‚ä½œä¸ºæºå‡½æ•°ã€‚
æƒ³è¦ `handler` å…¼å®¹ä¼ å‚ï¼Œéœ€è¦æ»¡è¶³ä¸‰ä¸ªæ¡ä»¶ã€‚

1. **å‚æ•°ä¸ªæ•°**ï¼š

   > **ç›®æ ‡å‡½æ•° > æºå‡½æ•°**

   ```ts
   let handler1 = (a: number) => number;
   hof(handler1); // ok!
   let handler2 = (a: number, b: number, c: number) => number;
   hof(handler2); // error!
   ```

   å…³äº **å¯é€‰å‚æ•°å’Œå‰©ä½™å‚æ•°**

   1. å›ºå®šå‚æ•° å…¼å®¹ å¯é€‰å‚æ•°å’Œå‰©ä½™å‚æ•°
   2. å¯é€‰å‚æ•° ä¸å…¼å®¹ å›ºå®šå‚æ•°å’Œå‰©ä½™å‚æ•°
   3. å‰©ä½™å‚æ•° å…¼å®¹ å›ºå®šå‚æ•°å’Œå¯é€‰å‚æ•°

   ```ts
   let a = (a: number, b: number) => number;
   let b = (a?: number, b?: number) => number;
   let c = (...args: number[]) => number;

   a = b;
   a = c;
   b = a;
   b = c;
   c = a;
   c = b;
   ```

2. **å‚æ•°ç±»å‹**

   > **å‚æ•°ç±»å‹å¿…é¡»è¦åŒ¹é…ã€‚**

   ```ts
   let handler3 = (a: string) => string;
   hof(handler3); // error!
   ```

   å‚æ•°ç±»å‹å¤æ‚çš„æƒ…å†µï¼ˆå¯¹è±¡ç±»å‹ï¼‰ï¼šå°†å¯¹è±¡å±æ€§çœ‹æˆä¼ å‚ï¼Œå¥—ç”¨å‚æ•°ä¸ªæ•°è§„åˆ™ï¼Œå¤šçš„å…¼å®¹å°‘çš„ã€‚

   ```ts
   interface point3D {
     a: number;
     b: number;
     c: number;
   }
   interface point2D {
     a: number;
     b: number;
   }
   let p3d = (value: point3D) => {};
   let p2d = (value: point2D) => {};

   p3d = p2d;
   p2d = p3d; // error! strictFunctionTypes: falseï¼Œå¯ä»¥å…¼å®¹ã€‚
   ```

   - **å‡½æ•°å‚æ•°åŒå‘åå˜**ï¼š

     > å‡½æ•°å‚æ•°ä¹‹é—´å¯ä»¥äº’ç›¸å…¼å®¹ã€‚

     é¦–å…ˆæˆ‘ä»¬éœ€è¦çŸ¥é“ï¼Œå‡½æ•°è¿™ä¸€ç±»å‹æ˜¯é€†å˜çš„ã€‚å‡½æ•°å¯ä»¥çœ‹æˆæ˜¯ä¸€æŠŠæ“ä½œçš„é›†åˆï¼Œå­ç±»å‚æ•° `<Dog>` æ¯”çˆ¶ç±»å‚æ•° `<Animal>` æ‹¥æœ‰æ›´å¤šçš„å±æ€§/æ–¹æ³•ã€‚å‚æ•° `<Animal>` å¯ä»¥ä¿è¯å®Œå…¨è¦†ç›–å‡½æ•°å†…è°ƒç”¨åˆ°çš„å±æ€§/æ–¹æ³•ã€‚å› æ­¤ `<Animal> => {}` æ˜¯ `<Dog> => {}` çš„å­é›†ï¼Œå…¼å®¹æ€§æ˜¯ç›¸åçš„ï¼Œæ˜¯é€†å˜ã€‚

     **é‚£ä¸ºä»€ä¹ˆåˆä¼šæœ‰åŒå‘åå˜å‘¢ï¼Ÿ**

     ä¸ºäº†ç»´æŒç»“æ„åŒ–ç±»å‹çš„å…¼å®¹æ€§ï¼Œ`TypeScript` å›¢é˜Ÿåšäº†ä¸€ä¸ªæƒè¡¡ (`trade-off`)ã€‚ä¿æŒäº†å‡½æ•°ç±»å‹çš„åŒå‘åå˜æ€§ã€‚ä½†æ˜¯æˆ‘ä»¬å¯ä»¥é€šè¿‡è®¾ç½®ç¼–è¯‘é€‰é¡¹ `--strictFunctionTypes: true` æ¥ä¿æŒå‡½æ•°çš„é€†å˜æ€§è€Œå…³é—­åå˜æ€§ã€‚

3. **è¿”å›å€¼ç±»å‹**

   > åŒ â€œ ç»“æ„ä¹‹é—´å…¼å®¹ï¼šæˆå‘˜å°‘çš„å…¼å®¹æˆå‘˜å¤šçš„ã€‚â€

   ```ts
   let f = () => ({
     a: number,
   });
   let g = () => ({ a: number, b: number });

   f = g; //  OKï¼
   g = f; // error!
   ```

   - **å‡½æ•°é‡è½½**
     å‡½æ•°é‡è½½åˆ—è¡¨é‡çš„å‡½æ•° è¦å…¼å®¹ æ‰§è¡Œå‡½æ•°ã€‚
     ```ts
     function overload(a: number, b: number): number; // ç›®æ ‡å‡½æ•°
     function overload(a: string, b: string): string; // ç›®æ ‡å‡½æ•°
     function overload(a: any, b: any): any {} // æºå‡½æ•°
     ```

### æšä¸¾ç±»å‹

> æšä¸¾é»˜è®¤å’Œæ•°å€¼å®Œå…¨å…¼å®¹
> æšä¸¾ä¹‹é—´å®Œå…¨ä¸å…¼å®¹

```ts
enum Fruit {
  Apple,
  Banana = "banana",
}
enum Color {
  Red,
  Green,
}
let fruit1: Fruit.Apple = 1; // ok!
let fruit2: Fruit.Banana = 1; // error!
let color1: Color = Color.Red; // ok!
let color2: Color = Fruit.Apple; // error!
```

### ç±»

> ç±»å’Œæ¥å£ç›¸ä¼¼ï¼Œä½†æœ‰ä¸€ç‚¹ä¸åŒï¼šé™æ€æˆå‘˜(`static`)å’Œæ„é€ å‡½æ•°ä¸åœ¨æ¯”è¾ƒçš„èŒƒå›´å†…ã€‚

```ts
class Fruit {
  constructor(name: string, age: number) {
    this.name = name;
    this.age = age;
  }
  name: string;
  size: number = 0;
  age: number;
}
class Clothes {
  static len: number = 100;
  constructor(name: string) {
    this.name = name;
  }
  name: string;
  size: number = 0;
}
let f = new Fruit("apple", 12);
let c = new Clothes("t-shirt");

f = c; // error!
c = f; // ok!
```

ç±»ä¸­æœ‰ç§æœ‰æˆå‘˜ï¼ˆ`private`ï¼‰ï¼Œåªèƒ½çˆ¶ç±»å…¼å®¹å­ç±»ï¼ˆæˆ–ç›¸äº’å…¼å®¹ï¼‰ã€‚

```ts
class Fruit {
  constructor(name: string, age: number) {
    this.name = name;
    this.age = age;
  }
  name: string;
  private size: number = 0;
}
class Apple extends Fruit {}
let a = new Apple("apple", 1);
f = a; // OKï¼
```

### æ³›å‹

```ts
interface Empty<T> {}
let a: Empty<number>;
let b: Empty<string>;

a = b!; // OK, because y matches structure of x
```

ä¸Šé¢ä»£ç é‡Œï¼Œ`x` å’Œ `y` æ˜¯å…¼å®¹çš„ï¼Œå› ä¸ºå®ƒä»¬çš„ç»“æ„ä½¿ç”¨ç±»å‹å‚æ•°æ—¶å¹¶æ²¡æœ‰ä»€ä¹ˆä¸åŒã€‚

```ts
interface NotEmpty<T> {
  data: T;
}
let x: NotEmpty<number>;
let y: NotEmpty<string>;

x = y; // error!
```

å¯¹äºæ²¡æŒ‡å®šæ³›å‹ç±»å‹çš„æ³›å‹å‚æ•°æ—¶ï¼Œä¼šæŠŠæ‰€æœ‰æ³›å‹å‚æ•°å½“æˆ `any` æ¯”è¾ƒã€‚ ç„¶åç”¨ç»“æœç±»å‹è¿›è¡Œæ¯”è¾ƒï¼Œæ¯”å¦‚ã€‚

```ts
let identity = function <T>(x: T): T {
  return x;
};

let reverse = function <U>(y: U): U {
  return y;
};

identity = reverse; // OK, because (x: any) => any matches (y: any) => any
```

## ç±»å‹ä¿æŠ¤

> ç±»å‹ä¿æŠ¤å…è®¸ä½ ä½¿ç”¨æ›´å°èŒƒå›´ä¸‹çš„å¯¹è±¡ç±»å‹ã€‚

- ç°åœ¨æœ‰è¿™æ ·ä¸€ä¸ª demoğŸ‘‡

  ```ts
  enum Type {
    Strong,
    Week,
  }

  class Java {
    helloJava() {
      console.log("hello java");
    }
  }

  class JavaScript {
    helloJavaScript() {
      console.log("hello javascript");
    }
  }

  function getLanguage(type: Type) {
    let lang = type === Type.Strong ? new Java() : new JavaScript();
    return lang;
  }

  getLanguage(Type.Strong);
  getLanguage(Type.Week);
  ```

  ç°åœ¨ï¼Œæˆ‘ä»¬æƒ³åœ¨ `getLanguage` é‡Œè°ƒç”¨ `Java/JavaScript` çš„ hello æ–¹æ³•ã€‚

  ```ts
  function getLanguage(type: Type) {
    let lang = type === Type.Strong ? new Java() : new JavaScript();
    if (lang.helloJava) {
      // error!
      lang.helloJava(); // error!
    } else {
      lang.helloJavaScript(); // error!
    }
    return lang;
  }
  ```

  `Property 'helloJava'/'helloJavaScript' does not exist on type 'Java | JavaScript'.`
  å½“ç„¶ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡ **ç±»å‹æ–­è¨€** æ¥å»æ‰é”™è¯¯ã€‚

  ```ts
  function getLanguage(type: Type) {
    let lang = type === Type.Strong ? new Java() : new JavaScript();
    if ((lang as Java).helloJava) {
      (lang as Java).helloJava();
    } else {
      (lang as JavaScript).helloJavaScript();
    }
    return lang;
  }
  ```

  ä½†æ˜¯æˆ‘ä»¬è¦åœ¨æ¯ä¸€å¤„éƒ½æ·»åŠ ç±»å‹æ–­è¨€ï¼Œè¿™æ˜¾ç„¶ä¸æ˜¯åˆç†çš„è§£å†³æ–¹æ¡ˆï¼›äºæ˜¯ï¼Œæˆ‘ä»¬å°±è¦å¯åŠ¨ **ç±»å‹ä¿æŠ¤ä½“åˆ¶** äº†ã€‚
  `ts` èƒ½å¤Ÿåœ¨ç‰¹å®šçš„åŒºå—ä¸­ä¿è¯å˜é‡å±äºæŸç§ç¡®å®šçš„ç±»å‹ï¼›åœ¨æ­¤åŒºå—ä¸­ï¼Œå¯ä»¥æ³›å‹ä½¿ç”¨æ­¤ç±»å‹çš„å±æ€§ï¼Œè°ƒç”¨æ­¤ç±»å‹çš„æ–¹æ³•ã€‚

- **instanceof**

  > åˆ¤æ–­ä¸€ä¸ªå®ä¾‹æ˜¯å¦å±äºæŸä¸ªç±»

  ```ts
  function getLanguage(type: Type) {
    let lang = type === Type.Strong ? new Java() : new JavaScript();
    // instanceof
    if (lang instanceof Java) {
      lang.helloJava();
    } else {
      lang.helloJavaScript();
    }
    return lang;
  }
  ```

- **in**

  > åˆ¤æ–­ä¸€ä¸ªå±æ€§æ˜¯å¦å±äºæŸä¸ªå¯¹è±¡

  ```ts
  function getLanguage(type: Type) {
    let lang = type === Type.Strong ? new Java() : new JavaScript();
    // in
    if ("helloJava" in lang) {
      lang.helloJava();
    } else {
      lang.helloJavaScript();
    }
    return lang;
  }
  ```

- **typeof**

  > åˆ¤æ–­ä¸€ä¸ªå˜é‡çš„ç±»å‹

  ```ts
  function doSome(x: number | string) {
    if (typeof x === "string") {
      x.length;
    } else {
      x++;
    }
    return x;
  }
  ```

- **ä¿æŠ¤å‡½æ•°**

  > æŸäº›åˆ¤æ–­å¯èƒ½ä¸æ˜¯ä¸€æ¡è¯­å¥èƒ½å¤Ÿæå®šçš„ï¼Œéœ€è¦æ›´å¤šå¤æ‚çš„é€»è¾‘ï¼Œé€‚åˆå°è£…åˆ°ä¸€ä¸ªå‡½æ•°å†…

  ```ts
  function isJava(lang: Java | JavaScript): lang is Java {
    // ç±»å‹è°“è¯
    return (lang as Java).helloJava !== undefined;
  }

  function getLanguage(type: Type) {
    let lang = type === Type.Strong ? new Java() : new JavaScript();

    // ä¿æŠ¤å‡½æ•°
    if (isJava(lang)) {
      lang.helloJava();
    } else {
      lang.helloJavaScript();
    }

    return lang;
  }
  ```
